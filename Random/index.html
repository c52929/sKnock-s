<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Rand 4U</title>
	<link rel="icon" href="icon.png">
	<link rel="apple-touch-icon" href="apple-touch-icon.png">
	<link rel="stylesheet" href="css/styles.min.css">
	<!-- <link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet"> -->
</head>
<body>
	<div class="inner">
		<h1>Rand for You</h1>
		<div class="adding">
			<input type="text" name="add_content" id="add_content" class="text">
			<input type="submit" value="追加" id="add_button" class="button">
			<div id="error"></div>
		</div>
		<div class="list_container">
			<h2>リスト</h2>
			<ul id="list"></ul>
			<div class="clear none" id="listClear">クリア</div>
		</div>
		<input type="submit" value="決定" id="start_button" class="button">
		<div class="results" id="results">
			<h2 id="result_title">Result</h2>
			<div class="clear none" id="resultClear">クリア</div>
		</div>
	</div>

	<script>
		'use strict';

		let list=[];

		document.getElementById('add_content').focus();
	
		document.getElementById('add_button').addEventListener('click',()=>{
			put_function();
		})
		document.addEventListener('keydown',(event)=>{
			if(`${event.key}`=='Enter'){
				let check=document.getElementById('add_content');
				let active=document.activeElement;
				if(check==active){
					put_function();
				}
			}
		})
		function put_function(){
			if(add_content.value==''){
				document.getElementById('error').textContent='文字を入力してください';
			}else if(list.indexOf(add_content.value)>-1){
				document.getElementById('error').textContent='「'+add_content.value+'」: リストに追加済みです';
			}else{
				document.getElementById('error').textContent='';
				const add=document.createElement('li');
				add.textContent=add_content.value;
				document.getElementById('list').appendChild(add);
				list.push(add_content.value);
				document.getElementById('add_content').value='';
				document.getElementById('add_content').focus();
				document.getElementById('listClear').classList.remove('none');
			}
		}

		let historyLength=0;
		let date;
		let timeInfo;
		function getDate(){
			date=new Date();
			timeInfo=[`${('00'+date.getHours()).slice(-2)}:${('00'+date.getMinutes()).slice(-2)}:${('00'+date.getSeconds()).slice(-2)}`,`${('000'+Math.floor(date.getMilliseconds())).slice(-3)}`];
		}

		document.getElementById('start_button').addEventListener('click',()=>{
			if(list.length<=1){
				document.getElementById('error').textContent='要素数が少ないです';
			}else{
				document.getElementById('resultClear').classList.remove('none');
				document.getElementById('error').textContent='';
				const addResult=document.createElement('div');
				addResult.classList.add('result');
				addResult.classList.add(`${['even','odd'][historyLength%2]}`);
				getDate();
				addResult.innerHTML=`<span>${list[Math.floor(Math.random()*list.length)]}</span><span class="time">${timeInfo[0]}<span class="dec">.${timeInfo[1]}</span></span>`;
				document.getElementById('result_title').parentNode.insertBefore(addResult,document.getElementById('result_title').nextSibling);
				historyLength++;
			}
		})

		document.getElementById('listClear').addEventListener('click',()=>{
			list=[];
			let removeList=document.querySelectorAll('li');
			for(let i=0; i<removeList.length; i++){
				removeList[i].remove();
			}
			document.getElementById('listClear').classList.add('none');
			document.getElementById('add_content').focus();
		})

		document.getElementById('resultClear').addEventListener('click',()=>{
			let removeResult=document.querySelectorAll('.result');
			for(let i=0; i<removeResult.length; i++){
				removeResult[i].remove();
			}
			document.getElementById('resultClear').classList.add('none');
		})
	</script>
</body>
</html>